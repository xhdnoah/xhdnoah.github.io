<!doctype html><html><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet type=text/css href=/css/bootstrap.min.css>
<link rel=stylesheet type=text/css href=/css/style.css>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/prismjs@1.24.1/themes/prism.css>
<link rel=icon type=image/png href=/images/favicon.ico>
<link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%221em%22 font-size=%2280%22>ğŸŒ•</text></svg>">
<script src=https://cdn.jsdelivr.net/npm/prismjs@1.24.1/components/prism-core.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/prismjs@1.24.1/plugins/autoloader/prism-autoloader.min.js></script>
<script defer src=https://use.fontawesome.com/93f8d6d0b2.js></script>
<title>ç”µå­æœˆäº® | UnderScore: é›†åˆ</title>
</head>
<body>
<header class="header fadeInTop content">
<a class=no-highlight href=/>ElectronicMoon</a>
</header>
<main class=main>
<div class="content-container fadeInTop">
<div class=content>
<h1 class=title>UnderScore: é›†åˆ</h1>
<div class=post-meta>
<time datetime="2019-03-19 00:00:00 +0000 UTC">Mar 19, 2019</time>
</div>
<p><strong>_.each</strong></p>
<pre><code class=language-js>_.each = _.forEach = function(obj,iteratee, context){
  // é¦–å…ˆè¦ä¼˜åŒ–å›è°ƒè¿‡ç¨‹
  iteratee = optimizeCb(iteratee, context)
  var i, length
  if(isArrayLike(obj)){
    for(i = 0, length = obj.length; i &lt; length; i++){
      // æ•°ç»„è¿­ä»£å›è°ƒä¼ å…¥ä¸‰å‚æ•°ï¼šè¿­ä»£å€¼ï¼Œè¿­ä»£ç´¢å¼•ï¼Œè¿­ä»£å¯¹è±¡
      iteratee(obj[i], i, obj)
    }
  } else {
    var keys = _.keys(obj)
    for (i = 0, length = keys.length; i &lt; length; i++){
      // å¯¹è±¡è¿­ä»£å›è°ƒä¼ å…¥ä¸‰å‚æ•°ï¼šè¿­ä»£å€¼ï¼Œè¿­ä»£ keyï¼Œè¿­ä»£å¯¹è±¡
      iteratee(obj[keys[i],keys[i],obj)
    }
  }
  // è¿”å›å¯¹è±¡è‡ªèº«ï¼Œä»¥ä¾¿è¿›è¡Œé“¾å¼æ„é€ 
}
</code></pre>
<h2 id=map-reduce>map-reduce</h2>
<p>map reduce æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„é‡è¦ç»„æˆï¼Œæ˜¯ä¸€ç§å¯¹åˆ—è¡¨çš„æ“ä½œæ€è·¯ã€‚</p>
<ul>
<li><strong>map</strong>ï¼ˆæ˜ å°„ï¼‰ï¼šä¸€ä¸ªæ˜ å°„è¿‡ç¨‹å°±æ˜¯å°†å„ä¸ªå…ƒç´ æŒ‰ç…§è§„åˆ™é€ä¸ªæ˜ å°„ä¸ºæ–°çš„å…ƒç´ </li>
<li><strong>reduce</strong>ï¼ˆè§„çº¦ï¼‰ï¼šä¸€ä¸ªè§„çº¦è¿‡ç¨‹è¿­ä»£æ¯ä¸ªå…ƒç´ æŒ‰ç…§è§„åˆ™åˆå¹¶åˆ°ä¸€ä¸ªç›®æ ‡å¯¹è±¡ä¸Š</li>
</ul>
<h3 id=map-åœ¨-underscore-ä¸­çš„å®ç°>map åœ¨ underscore ä¸­çš„å®ç°</h3>
<ul>
<li>åˆ›å»ºä¸€ä¸ªæ–°åˆ—è¡¨æˆ–å…ƒç´ </li>
<li>éå†åŸåˆ—è¡¨æˆ–åŸå¯¹è±¡çš„å€¼ï¼Œç”¨æŒ‡å®šçš„å‡½æ•° <code>func</code> ä½œç”¨äºæ¯ä¸ªéå†åˆ°çš„å…ƒç´ ï¼Œè¾“å‡ºä¸€ä¸ªæ–°çš„å…ƒç´ æ”¾å…¥æ–°åˆ—è¡¨æˆ–å¯¹è±¡ä¸­</li>
</ul>
<pre><code class=language-js>_.map = _.collect = function (obj, iteratee, context) {
  iteratee = cb(iteratee, context);
  var keys = !isArrayLike(obj) &amp;&amp; _.keys(obj),
    length = (keys || obj).length,
    results = Array(length); // å®šé•¿åˆå§‹åŒ–æ•°ç»„
  for (var index = 0; index &lt; length; index++) {
    var currentKey = keys ? keys[index] : index;
    results[index] = iteratee(obj[currentKey], currentKey, obj);
  }
  return results;
};
</code></pre>
<h3 id=reduce-åœ¨-underscore-ä¸­çš„å®ç°>reduce åœ¨ underscore ä¸­çš„å®ç°</h3>
<p>underscore åˆ›å»ºäº†ä¸€ä¸ªå†…éƒ¨å‡½æ•° <code>createReducer</code> ç”¨æ¥åˆ›å»º reduce å‡½æ•°ï¼Œå®Œæˆï¼š</p>
<ul>
<li>åŒºåˆ† reduce çš„æ–¹å‘ <code>dir</code>ï¼Œæ˜¯ä»åºåˆ—å¼€ç«¯å¼€å§‹åšè§„çº¦è¿‡ç¨‹ï¼Œè¿˜æ˜¯ä»åºåˆ—æœ«ç«¯å¼€å§‹åš</li>
<li>åˆ¤æ–­ç”¨æˆ·åœ¨ä½¿ç”¨ <code>_.reduce</code> æˆ– <code>_.reduceRight</code> æ—¶ï¼Œæ˜¯å¦ä¼ å…¥äº†ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå³æ˜¯å¦ä¼ å…¥äº†è§„çº¦èµ·ç‚¹ï¼Œåˆ¤æ–­ç»“æœç”± <code>initial</code> å˜é‡æ ‡è¯†</li>
</ul>
<p>å¯¹äºä¸€ä¸ª reduce å‡½æ•°ï¼Œå…¶æ‰§è¡Œè¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>
<ul>
<li>è®¾ç½®ä¸€ä¸ªå˜é‡ <code>memo</code> ç”¨ä»¥ç¼“å­˜å½“å‰è§„çº¦è¿‡ç¨‹çš„ç»“æœï¼Œå¦‚æœç”¨æˆ·æœªåˆå§‹åŒ– <code>memo</code>ï¼Œåˆ™ <code>memo</code> ä¸ºåºåˆ—çš„ä¸€ä¸ªå‚æ•°ã€‚éå†å½“å‰é›†åˆï¼Œå¯¹æœ€è¿‘è¿­ä»£åˆ°çš„å…ƒç´ æŒ‰ä¼ å…¥çš„ <code>func</code> è¿›è¡Œè§„çº¦æ“ä½œï¼Œåˆ·æ–° <code>memo</code></li>
<li>è§„çº¦è¿‡ç¨‹å®Œæˆï¼Œè¿”å› <code>memo</code></li>
</ul>
<pre><code class=language-js>var createReduce = function (dir) {
  var reducer = function (obj, iteratee, memo, initial) {
    var keys = !isArrayLike(obj) &amp;&amp; _.keys(obj),
      length = (keys || obj).length,
      index = dir &gt; 0 ? 0 : length - 1;
    // å¦‚æœ reduce æ²¡æœ‰åˆå§‹åŒ– memoï¼Œåˆ™é»˜è®¤ä¸ºé¦–ä¸ªå…ƒç´ ï¼ˆä»å·¦å¼€å§‹åˆ™ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä»å³åˆ™ä¸ºæœ€åä¸€ä¸ªå…ƒç´ ï¼‰
    if (!initial) {
      memo = obj[keys ? keys[index] : index];
      index += dir;
    }
    for (; index &gt;= 0 &amp;&amp; index &lt; length; index += dir) {
      // æ‰§è¡Œ reduce å›è°ƒï¼Œåˆ·æ–°å½“å‰å€¼
      memo = iteratee(memo, obj[currentKey], currentKey, obj);
    }
    return memo;
  };
  return function (obj, iteratee, memo, context) {
    // å¦‚æœå‚æ•°æ­£å¸¸ï¼Œåˆ™ä»£è¡¨å·²ç»åˆå§‹åŒ–äº† memo
    var initial = arguments.length &gt;= 3;
    // æ‰€æœ‰ä¼ å…¥çš„å›è°ƒéƒ½è¦é€šè¿‡ optimizeCb è¿›è¡Œä¼˜åŒ–
    // reducer å› ä¸ºå¼•å…¥ç´¯åŠ å™¨ï¼Œæ‰€ä»¥ä¼˜åŒ–å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥äº† 4
    // è¿™æ ·ï¼Œæ–°çš„è¿­ä»£å›è°ƒç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯å½“å‰çš„ç´¯åŠ ç»“æœ
    // _.reduce([1,2,3],function(prev,current){})
    return reducer(obj, optimizeCb(iteratee, context, 4), memo, initial);
  };
};
</code></pre>
<p>æœ€ç»ˆï¼Œï¼Œunderscore æš´éœ²ç»™äº†ä¸¤ä¸ªæ–¹å‘çš„ reduce API ç»™ç”¨æˆ·ï¼š</p>
<pre><code class=language-js>// ä»å·¦åˆ°å³è§„çº¦
_.reduce = _.fold1 = _.inject = createReduce(1);
// ç”±å³è‡³å·¦è§„çº¦
_.reduceRight = _.foldr = createReduce(-1);
</code></pre>
<h3 id=æŸ¥è¯¢>æŸ¥è¯¢</h3>
<p>å¯¹äºå…ƒç´ ä½ç½®æŸ¥è¯¢ï¼Œunderscore æä¾›ä»¥ä¸‹ APIï¼š</p>
<ul>
<li><code>_.indexOf</code></li>
<li><code>_.lastIndexOf</code></li>
<li><code>_.findIndex</code></li>
<li><code>_.findLastIndex</code></li>
<li><code>_.sortedIndex</code></li>
</ul>
<blockquote>
<p><code>_.indexOf</code> åŠ <code>_.lastIndexOf</code> åªæ”¯æŒå¯¹äºæ•°ç»„å…ƒç´ çš„æœç´¢</p>
</blockquote>
<p>å¯¹äºå…ƒç´ æŸ¥è¯¢ã€‚underscroe æä¾›ä»¥ä¸‹ APIï¼š</p>
<ul>
<li><code>_.find</code> = <code>_.detect</code></li>
<li><code>_.findWhere</code></li>
<li><code>_.where</code></li>
</ul>
<p>å¦‚æœé›†åˆæ˜¯å¯¹è±¡ï¼Œå³é›†åˆæ˜¯é”®å€¼å¯¹æ„æˆçš„ï¼Œåˆ™æä¾›ä»¥ä¸‹ API</p>
<ul>
<li><code>_findKey</code></li>
<li><code>_.pluck</code></li>
</ul>
<p>å¯¹äºåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œunderscore æä¾›ä»¥ä¸‹ API</p>
<ul>
<li><code>_.contains</code></li>
</ul>
<h3 id=createindexfinder><code>createIndexFinder</code></h3>
<p>underscore é€šè¿‡å†…ç½®çš„å·¥å‚å‡½æ•° <code>createIndexFinder</code> åˆ›å»ºä¸€ä¸ªç´¢å¼•æŸ¥è¯¢å™¨ï¼Œ<code>_.indexOf</code> åŠ <code>_.lastIndexOf</code> æ­£æ˜¯ç”±è¯¥å‡½æ•°åˆ›å»º</p>
<p><code>createIndexFinder(dir, predicateFind, sortedIndex)</code> æ¥æ”¶ä¸‰ä¸ªå‚æ•°</p>
<ul>
<li>dirï¼šæŸ¥è¯¢æ–¹å‘ï¼Œ<code>_.indexOf</code> æ­£å‘æŸ¥è¯¢ï¼Œ<code>_lastIndexOf</code> åå‘æŸ¥è¯¢</li>
<li>predicateFindï¼šçœŸå€¼æ£€æµ‹å‡½æ•°ï¼Œè¯¥å‡½æ•°åªæœ‰åœ¨æŸ¥è¯¢å…ƒç´ ä¸æ˜¯æ•°å­—æ—¶ï¼ˆ<code>NaN</code>) æ‰ä¼šä½¿ç”¨</li>
<li>sortedIndexï¼šæœ‰åºæ•°ç»„çš„ç´¢å¼•è·å¾—å‡½æ•°ï¼Œå¦‚æœè®¾ç½®äº†è¯¥å‚æ•°ï¼Œå°†å‡å®šæ•°ç»„å·²ç»æœ‰åºï¼Œä»è€Œæ›´åŠ é«˜æ•ˆåœ°é€šè¿‡é’ˆå¯¹æœ‰åºæ•°ç»„çš„æŸ¥è¯¢å‡½æ•°ï¼ˆæ¯”å¦‚äºŒåˆ†æŸ¥æ‰¾ï¼‰æ¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½</li>
</ul>
<pre><code class=language-js>var createIndexFinder = function(dir, predicateFind, sortedIndex){
  return function (array, item, idx){
    var i = 0, length = getLength(array)
    // å¦‚æœ idx ä¸º Numberï¼Œåˆ™è§„å®šæŸ¥æ‰¾ä½ç½®çš„èµ·å§‹ç‚¹
    if(tyepof idx == 'number'){
      if(dir &gt; 0){
          // æ­£å‘æŸ¥æ‰¾ï¼Œé‡ç½®æŸ¥æ‰¾èµ·å§‹ç‚¹
        i = idx &gt;= 0 ? idx : Math.max(idx + length , i)
      } else {
          // åå‘æŸ¥æ‰¾ï¼Œé‡ç½® length å€¼
        length = idx &gt;= 0 ? Math.min(idx + 1, length) : idx + length + 1
      } else if(sortedIndex &amp;&amp; idx &amp;&amp; length){
        // èƒ½ç”¨äºŒåˆ†æŸ¥æ‰¾åŠ é€Ÿçš„æ¡ä»¶
        idx = sortedIndex(array, item)
        return array[index] === item ? idx : -1
      }
      // ç‰¹åˆ¤ï¼Œå¦‚æœæŸ¥æ‰¾å…ƒç´ æ˜¯ NaN ï¼ˆif item !== item then item =&gt; NaN
      if(item !== item){
        idx = predicateFind(slice.call(array, i, length), _.isNaN)
        return idx &gt;= 0 ? idx + i : -1
      }
      // O(n) éå†æŸ¥æ‰¾ï¼Œç‰¹åˆ¤æ’é™¤äº† NaNï¼Œå¯ä»¥æ”¾å¿ƒ === åˆ¤æ–­ç›¸ç­‰
      for(idx = dir &gt; 0 ? i : length - 1; idx &gt;= 0 &amp;&amp; idx &lt; length; idx += dir){
        if (array[idx] === item) return idx
      }
      return -1
    }
  }
}
</code></pre>
<p><strong><code>_.indexOf(array,item,sorted)</code></strong></p>
<pre><code class=language-js>_.indexOf = createIndexFinder(1,_.findIndex,_.sortedIndex)
</code></pre>
<p><strong><code>_.lastIndexOf(array,item,sorted)</code></strong></p>
<pre><code class=language-js>_.lastIndexOf = createIndexFinder(-1,_.findLastIndex)
</code></pre>
<p><strong><code>_.sortedIndex(array, obj, iteratee)</code></strong> ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾</p>
<blockquote>
<p>æ ¹æ®æ¯”è¾ƒæ¡ä»¶ iteratee æŸ¥è¯¢ obj åœ¨ array ä¸­çš„ä½ç½®</p>
</blockquote>
<pre><code class=language-js>_.sortedIndex = function (array, obj, iteratee, context) {
  iteratee = cb(iteratee, context, 1);
  var value = iteratee(obj);
  var low = 0,
    high = getLength(array);
  while (low &lt; high) {
    var mid = Math.floor((low + high) / 2);
    if (iteratee(array[mid]) &lt; value) low = mid + 1;
    else high = mid;
  }
  return low;
};
</code></pre>
<p><strong><code>createPredicateIndexFinder</code></strong></p>
<p>é™¤äº† <code>createIndexFinder</code>ï¼Œunderscore è¿˜å†…ç½®äº†ä¸€ä¸ª <code>createPredicateIndexFinder</code> çš„å·¥å‚å‡½æ•°ï¼Œä¸ä»…èƒ½æŸ¥è¯¢ç›´æ¥é‡åœ¨é›†åˆä¸­çš„ä½ç½®ï¼Œä¹Ÿé€šè¿‡ä¸€ä¸ªçœŸå€¼æ£€æµ‹å‡½æ•°æŸ¥æ‰¾ä½ç½®</p>
<pre><code class=language-js>var createPredicateIndexFinder = function (dir) {
  return function (array, predicate, context) {
    predicate = cb(predicate, context);
    var length = getLength(array);
    var index = dir &gt; 0 ? 0 : length - 1;
    for (; index &gt; 0 &amp;&amp; index &lt; length; index += dir) {
      if (predicate(array[index], index, array)) return index;
    }
    return -1;
  };
};
</code></pre>
<p><strong><code>_.findIndex(array, predicate)</code></strong> æ ¹æ®æ¡ä»¶ <code>predicate</code> ï¼ŒæŸ¥è¯¢å…ƒç´ åœ¨ <code>array</code> ä¸­å‡ºç°çš„ä½ç½®</p>
<p><code>_.findIndex = createPredicateIndexFinder(1)</code></p>
<p>ç”¨ä¾‹ï¼š</p>
<pre><code class=language-js>// ä¸‹é¢è°ƒç”¨ä¸ä¼šè¿”å›3ï¼Œå› ä¸º 12 ä¼šè¢«ä¿®æ­£ä¸º _.property(12)
_.findIndex([4, 6, 8, 12], 12);
// =&gt; -1

_.findIndex([4, 6, 8, 12], function (value) {
  return value === 0;
}); // =&gt; 3
</code></pre>
<p><strong><code>_.findLastIndex(array, predicate)</code></strong></p>
<p><code>_.findLastIndex = createPredicateIndexFinder(-1)</code></p>
<p><strong><code>_.findKey(obj, predicate)</code></strong>ï¼šè¿”å› obj ä¸­ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„ <code>predicate</code> çš„ key</p>
<pre><code class=language-js>_.findKey = function (obj, predicate, context) {
  predicate = cb(predicate, context);
  var keys = _.keys(obj),
    key;
  for (var i = 0, length = keys.length; i &lt; length; i++) {
    key = keys[i];
    if (predicate(obj[key], key, obj)) return key;
  }
};
</code></pre>
<p>ç”¨ä¾‹ï¼š</p>
<pre><code class=language-js>var student = {
  name: &quot;xyz&quot;,
  age: 18,
};
_.findKey(student, function (value, key, obj) {
  return value === 18;
}); // =&gt; &quot;age&quot;
</code></pre>
<p><strong><code>_.find(obj, predicate) = _.detect</code></strong>ï¼šobj ä¸­æ»¡è¶³æ¡ä»¶ predicate çš„å…ƒç´ </p>
<pre><code class=language-js>_.find = _.detect = function (obj, predicate, context) {
  var keyFinder = isArrayLike(obj) ? _.findIndex : _.findKey;
  var key = keyFinder(obj, predicate, context);
  if (key !== void 0 &amp;&amp; key !== -1) return obj[key];
};
</code></pre>
<p><code>_.find</code> æ—¢èƒ½æ£€ç´¢æ•°ç»„ï¼ˆåˆ©ç”¨ <code>_.findIndex</code> å…ˆç¡®å®šå…ƒç´ ä¸‹æ ‡ï¼‰ï¼Œåˆèƒ½æ£€ç´¢å¯¹è±¡ï¼ˆåˆ©ç”¨ <code>_findKey</code> å…ˆç¡®å®š keyï¼‰</p>
<h3 id=where>where</h3>
<p>åœ¨ SQL ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸åˆ©ç”¨åˆ° <code>where</code> å…³é”®å­—ï¼š</p>
<p><code>select * from users where password="123456" and username="xyz"</code></p>
<p>åœ¨ JavaScript ä¸­æƒ³æ¨¡æ‹Ÿä¸€ä¸ª <code>where</code> å‡½æ•°ï¼Œå°±éœ€è¦ä¸ºå…¶ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><code>table</code>ï¼šé›†åˆ <code>users</code></li>
<li><code>attrs</code>ï¼šå±æ€§åŒ¹é…åˆ—è¡¨ <code>{password: '12345',username='xyz'}</code></li>
</ul>
<p><code>where</code> çš„æ ¸å¿ƒè¿‡ç¨‹ä¾ç„¶æ˜¯é›†åˆè¿‡æ»¤ï¼Œæ‰€ä»¥ <code>Array.prototype.filter</code> å°†æ˜¯ <code>where</code> çš„æ ¸å¿ƒï¼š</p>
<pre><code class=language-js>function where(table, attrs) {
  // éå† table
  return table.filter(function (elem) {
    // è§‚å¯Ÿå½“å‰éå†åˆ°çš„å¯¹è±¡æ˜¯å¦æ»¡è¶³ where æ¡ä»¶
    return Object.keys(attrs).every(function (attr) {
      return elem[attr] === attrs[attr];
    });
  });
}

// æµ‹è¯•
var users = [
  { name: &quot;wxj&quot;, age: 18, sex: &quot;male&quot; },
  { name: &quot;zxy&quot;, age: 18, sex: &quot;male&quot; },
  { name: &quot;zhangsan&quot;, age: 14, sex: &quot;famale&quot; },
];
var ret = where(users, { age: 18, sex: &quot;male&quot; });
// =&gt; [
// {name: 'wxj', age: 18, sex: 'male'},
// {name: 'zxy', age: 18, sex: 'male'},
//]
</code></pre>
<p><strong><code>_.where(obj, attrs)</code></strong>ï¼šè·å¾—æ»¡è¶³ <code>attrs</code> çš„å…ƒç´ </p>
<pre><code class=language-js>    _.where = function(obj. attrs){
      return _.filter(obj, _matcher(attrs))
    }
</code></pre>
<p><code>_.where</code> çš„å®ç°ååˆ†ç®€æ´ï¼Œåˆ©ç”¨åˆ°äº† <code>_.filter</code> è¿›è¡Œè¿­ä»£ï¼ŒçœŸå€¼æ£€æµ‹å‡½æ•°ç”¨åˆ°äº† <code>_.matcher</code></p>
<p><strong><code>_.matcher(attrs)</code></strong>ï¼šè¿”å›ä¸€ä¸ªæ ¡éªŒè¿‡ç¨‹ï¼Œç”¨ä»¥æ£€éªŒå¯¹è±¡å±æ€§æ˜¯å¦åŒ¹é…ç»™å®šçš„å±æ€§åˆ—è¡¨</p>
<pre><code class=language-js>_.matcher = _.matches = function (attrs) {
  attrs = _.extendOwn({}, attrs);
  return function (obj) {
    return _.isMatch(obj, attrs);
  };
};
</code></pre>
<p><code>_.matcher</code> æ¥å—ä¼ å…¥çš„å±æ€§åˆ—è¡¨ <code>attrs</code>ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªæ ¡éªŒè¿‡ç¨‹ï¼Œé€šè¿‡<code>_.isMatch</code> æ¥æ ¡éªŒ <code>obj</code> ä¸­çš„å±æ€§çš„æ˜¯å¦ä¸ <code>attrs</code> çš„å±æ€§ç›¸åŒ¹é…</p>
<p><strong><code>_.isMatch(obj, attrs)</code></strong></p>
<pre><code class=language-js>_.isMatch = function (object, attrs) {
  var keys = _.keys(attrs),
    length = keys.length;
  if (object == null) return !length;
  var obj = Object(object);
  for (var i = 0; i &lt; length; i++) {
    var key = keys[i];
    // ä¸€æ—¦é‡åˆ° value ä¸ç­‰ï¼Œæˆ– attrs ä¸­çš„ key ä¸åœ¨ obj ä¸­ï¼Œç«‹å³è¿”å› false
    if (attrs[key] !== obj[key] || !(key in obj)) return false;
  }
  return true;
};
</code></pre>
<p><strong><code>_.findWhere(obj, attrs)</code></strong>ï¼šä¸ <code>where</code> ç±»ä¼¼ï¼Œä½†åªè¿”å›ç¬¬ä¸€æ¡æŸ¥è¯¢åˆ°çš„è®°å½•</p>
<pre><code class=language-js>_.findWhere = function (obj, attrs) {
  return _.find(obj, _.matcher(attrs));
};
</code></pre>
<p><strong><code>_.contains(obj, item, fromIndex)=._includes=_.include</code></strong>ï¼šåˆ¤æ–­ obj æ˜¯å¦åŒ…å« itemï¼Œå¯è®¾ç½®æŸ¥è¯¢èµ·ç‚¹</p>
<pre><code class=language-js>_.contains = _.includes = _.include = function(obj, item, fromIndex, guard){
  if(!isArrayLike(obj) obj = _.values(obj))
  if(typeof fromIndex != 'number' || guard) fromIndex = 0
  return _.indexOf(obj, item, fromIndex) &gt;= 0
}
</code></pre>
<h2 id=underscore-æ¨¡æ‹Ÿä¸€æ®µ-sql>underscore æ¨¡æ‹Ÿä¸€æ®µ SQL</h2>
<blockquote>
<p><code>SELECT username, id FROM users where age&lt;30 group by sex;</code></p>
</blockquote>
<ul>
<li><code>_.groupBy</code></li>
<li><code>_.indexBy</code></li>
<li><code>_.countBy</code></li>
<li><code>_.partition</code></li>
</ul>
<p>ä»¥ä¸Šå‡½æ•°ç”±å†…éƒ¨å‡½æ•° <code>group</code> è¿”å›åˆ›å»º</p>
<h3 id=groupbehavior-partition><code>group(behavior, partition)</code></h3>
<ul>
<li><code>behavior</code> åˆ†ç±»è§„åˆ™ï¼ŒåŒ…æ‹¬<code>_.groupBy,_.indexBy,_.countBy</code></li>
<li><code>partition</code> æ˜¯å¦å°†é›†åˆä¸€åˆ†ä¸ºäºŒ</li>
</ul>
<pre><code class=language-js>var group = function (behavior, partition) {
  return function (obj, iteratee, context) {
    var result = partition ? [[], []] : {};
    iteratee = cb(iteratee, context);
    _.each(obj, function (value, index) {
      var key = iteratee(value, index, obj);
      behavior(result, value, key);
    });
    return result;
  };
};
</code></pre>
<p><strong><code>_.groupBy(obj, iteratee)</code></strong> å¯¹ obj æŒ‰ç…§ iteratee åˆ†ç»„</p>
<p>å½“ <code>iteratee</code> ç¡®å®šäº†ä¸€ä¸ªåˆ†ç»„ï¼Œ<code>_.groupBy</code> ï¼š</p>
<ul>
<li>å¦‚æœåˆ†ç»„ç»“æœä¸­å­˜åœ¨è¯¥åˆ†ç»„ï¼Œå°†å…ƒç´ è¿½åŠ è¿›è¯¥åˆ†ç»„</li>
<li>å¦åˆ™æ–°å»ºä¸€ä¸ªåˆ†ç»„ï¼Œå¹¶å°†å…ƒç´ æ”¾å…¥</li>
</ul>
<pre><code class=language-js>_.groupBy = group(function(result, value, key){
  if(_.has(result, key)) result[key].puah(value) else result[key] = [value]
})
</code></pre>
<p><strong><code>_.indexBy(obj, iteratee)</code></strong> å¯¹ obj æŒ‰ç…§ iteratee è¿›è¡Œç´¢å¼•</p>
<pre><code class=language-js>_.indexBy = group(function(result, value, key){
  result[key] = value
})
</code></pre>
<p><strong><code>_.countBy(obj, iteratee)</code></strong> å¯¹ obj æŒ‰ç…§ iteratee è¿›è¡Œè®¡æ•°</p>
<pre><code class=language-js>_.countBy = group(function (result, value, key) {
  if (_.has(result, key)) result[key]++;
  else result[key] = 1;
});
</code></pre>
<p>ç”¨ä¾‹ï¼š</p>
<pre><code class=language-js>_.countBy([1, 2, 3, 4, 5], function (num) {
  return num % 2 == 0 ? &quot;even&quot; : &quot;odd&quot;;
});
// =&gt; {odd: 3, even: 2}
</code></pre>
<p><strong><code>_.partition(obj, iteratee)</code></strong> å°† obj æŒ‰ç…§ iteratee è¿›è¡Œåˆ†ç»„</p>
<pre><code class=language-js>_.partition = group(function (result, value, pass) {
  // åˆ†ç»„åçš„è¡Œä¸º
  result[pass ? 0 : 1].push(value);
}, true);
</code></pre>
<p>ç”¨ä¾‹ï¼š</p>
<pre><code class=language-js>_.partition([0, 1, 2, 3, 4, 5], function (num) {
  return num % 2 !== 0;
});
// =&gt; [[1,3,5],[0,2,4]]
</code></pre>
</div>
</main>
</body>
</html>